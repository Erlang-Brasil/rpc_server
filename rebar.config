{erl_opts, [
    debug_info,
    {i, "include"},
    {parse_transform, lager_transform}
]}.

%% Dependências principais
{deps, [
    {lager, "3.9.2"}
]}.

%% Shell settings
{shell, [
    {config, "config/sys.config"},
    {apps, [rpc_server]}
]}.

%% Relx (para releases)
{relx, [
    {release, {rpc_server, "0.1.0"}, [
        kernel,
        stdlib,
        sasl,
        rpc_server
    ]},
    {mode, dev},
    {extended_start_script, true},
    {config, "config/sys.config"},
    {overlay, [
        {mkdir, "log/"}
    ]}
]}.

%% Perfis (como test)
{profiles, [
    {test, [
        {deps, [
            {proper, "1.4.0"},
            {eunit_formatters, "0.5.0"}
        ]},
        {erl_opts, [nowarn_export_all]},
        {src_dirs, ["src"]},
        {test_dirs, ["tests"]}
    ]}
]}.

%% Documentação (edoc)
{edoc_opts, [
    {preprocess, true},
    {macros, [{d, 'EDOC'}]},
    {private, true},
    {todo, true}
]}.

%% Coverage
{cover_enabled, true}.
{cover_opts, [verbose]}.

%% Plugins (rebar3)
{plugins, [
    {rebar3_proper, "0.12.1"},
    {rebar3_lint, "4.0.0"},
    {rebar3_codecov, "0.4.0"}
]}.

%% Configuração de sinks adicionais do Lager
{lager_extra_sinks, [
    {rpc_server_lager_event, [
        {handlers, [
            {lager_console_backend, [
                {level, info}
            ]},
            {lager_file_backend, [
                {file, "log/rpc_server.log"},
                {level, info},
                {size, 10485760},
                {date, "$D0"},
                {count, 5}
            ]}
        ]}
    ]}
]}.
